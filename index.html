<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéâ Il 18¬∞ Compleanno di Flavio Carlo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7b6cff;
            --secondary: #ff6b6b;
            --accent: #4ecdc4;
            --dark: #2d3047;
            --light: #f8f9fa;
            --gradient: linear-gradient(135deg, var(--primary), var(--accent));
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            /* SFONDO CON LA TUA IMMAGINE */
            background: linear-gradient(rgba(15, 12, 41, 0.85), rgba(36, 36, 62, 0.9)), url('https://i.ibb.co/1nJrmKM/2024-10-14.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--secondary);
            top: -20px;
            z-index: 0;
            animation: fall linear forwards;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(45, 48, 71, 0.7);
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .birthday-icon {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff6b6b, #7b6cff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .info-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .info-card i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .section {
            background: rgba(45, 48, 71, 0.8);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .hidden {
            display: none !important;
        }
        
        .lang-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .lang-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid transparent;
        }
        
        .lang-btn:hover {
            background: var(--primary);
            transform: translateY(-3px);
        }
        
        .lang-btn.active {
            background: var(--primary);
            border-color: var(--accent);
        }
        
        form {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--accent);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(123, 108, 255, 0.3);
        }
        
        .btn {
            display: inline-block;
            padding: 15px 35px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
            font-size: 16px;
            box-shadow: 0 10px 20px rgba(123, 108, 255, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(123, 108, 255, 0.6);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        #adminBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 10px 20px;
            background: rgba(45, 48, 71, 0.9);
            backdrop-filter: blur(10px);
        }
        
        #mapPlaceholder {
            height: 300px;
            background: linear-gradient(135deg, rgba(123, 108, 255, 0.2), rgba(78, 205, 196, 0.2));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }
        
        .success-message {
            background: rgba(78, 205, 196, 0.2);
            border: 2px solid var(--accent);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 30px 0;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .section {
                padding: 25px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .lang-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .lang-btn, .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .section {
                padding: 20px 15px;
            }
            
            input, select, textarea {
                padding: 12px;
                font-size: 16px;
            }
            
            .btn {
                padding: 14px 25px;
            }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            display: block;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        #lista {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .guest-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .guest-item:nth-child(odd) {
            border-left-color: var(--accent);
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .form-note {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 5px;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Confetti animati -->
    <div id="confetti-container"></div>
    
    <!-- Pulsante Admin -->
    <button id="adminBtn" class="btn hidden">
        <i class="fas fa-lock"></i> Admin
    </button>
    
    <div class="container">
        <!-- Header con informazioni festa -->
        <header class="floating">
            <div class="birthday-icon">
                üéÇ
            </div>
            <h1 id="mainTitle">Il 18¬∞ Compleanno di Flavio Carlo!</h1>
            <p class="subtitle" id="subtitle">Un giorno speciale da festeggiare insieme</p>
            
            <div class="info-grid">
                <div class="info-card">
                    <i class="fas fa-calendar-alt"></i>
                    <h3 id="dateTitle">Data</h3>
                    <p id="dateValue">Mercoled√¨, 1 Aprile 2026</p>
                </div>
                <div class="info-card">
                    <i class="fas fa-map-marker-alt"></i>
                    <h3 id="locationTitle">Luogo</h3>
                    <p id="locationValue">Casina dei nonni</p>
                </div>
                <div class="info-card">
                    <i class="fas fa-clock"></i>
                    <h3 id="timeTitle">Ora</h3>
                    <p id="timeValue">20:30</p>
                </div>
            </div>
            
            <div class="pulse">
                <a href="https://maps.app.goo.gl/kewUkDAfJCAtCezHA" id="mapLink" class="btn" target="_blank">
                    <i class="fas fa-map"></i> <span id="mapBtn">Vedi sulla Mappa</span>
                </a>
            </div>
        </header>
        
        <!-- Sezione Mappa -->
        <div class="section">
            <h2><i class="fas fa-map-marked-alt"></i> <span id="mapTitle">Come Raggiungerci</span></h2>
            <div id="mapPlaceholder">
                <div>
                    <i class="fas fa-map-pin" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <p id="mapText">Festa alla "Casina dei nonni"</p>
                    <p style="margin-top: 10px;">Clicca il pulsante sopra per aprire Google Maps</p>
                </div>
            </div>
        </div>
        
        <!-- Sezione Selezione Lingua -->
        <div id="lang" class="section">
            <h2><i class="fas fa-globe"></i> <span id="langTitle">Seleziona Lingua / Select Language</span></h2>
            <p id="langSubtitle" style="text-align: center; margin-bottom: 30px;">
                Scegli la lingua per compilare il modulo di partecipazione
            </p>
            
            <div class="lang-selector">
                <button onclick="setLang('it')" class="lang-btn active" id="langBtnIt">
                    <i class="fas fa-flag"></i> Italiano
                </button>
                <button onclick="setLang('en')" class="lang-btn" id="langBtnEn">
                    <i class="fas fa-flag-usa"></i> English
                </button>
            </div>
        </div>
        
        <!-- Sezione Form Partecipazione -->
        <div id="form" class="section hidden">
            <h2 id="formTitle">Conferma la tua partecipazione</h2>
            
            <!-- IL TUO ENDPOINT FORMSPREE √à INTEGRATO QUI -->
            <form id="rsvpForm" action="https://formspree.io/f/xreazzjo" method="POST">
                <!-- Campo nascosto per reindirizzamento e lingua -->
                <input type="hidden" name="_language" id="formLanguage" value="it">
                <input type="hidden" name="_subject" value="Conferma 18¬∞ Compleanno Flavio Carlo">
                <input type="hidden" name="_replyto" id="replyToField">
                
                <div class="form-group">
                    <label for="nome" id="nomeLabel">Nome e Cognome *</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                
                <div class="form-group">
                    <label for="email" id="emailLabel">Email *</label>
                    <input type="email" id="email" name="email" required>
                    <span class="form-note" id="emailNote">Riceverai una conferma e i dettagli per aggiungere l'evento al calendario</span>
                </div>
                
                <div class="form-group">
                    <label for="partecipazione" id="partecipazioneLabel">Parteciperai? *</label>
                    <select id="partecipazione" name="partecipazione" required>
                        <option value=""></option>
                        <!-- Le opzioni sono caricate da JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="allergie" id="allergieLabel">Allergie o Intolleranze Alimentari</label>
                    <textarea id="allergie" name="allergie" rows="3" placeholder="Nessuna"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="messaggio" id="messaggioLabel">Messaggio per Flavio (opzionale)</label>
                    <textarea id="messaggio" name="messaggio" rows="3" placeholder="Scrivi un messaggio..."></textarea>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                    <button type="submit" class="btn" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> <span id="submitText">Invia Risposta</span>
                    </button>
                    <button type="button" onclick="changeLang()" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> <span id="backText">Torna indietro</span>
                    </button>
                </div>
            </form>
            
            <div id="successMessage" class="success-message hidden">
                <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--accent); margin-bottom: 15px;"></i>
                <h3 id="successTitle">Grazie!</h3>
                <p id="successText">La tua risposta √® stata inviata con successo.</p>
                <p class="form-note" style="margin-top: 10px;" id="emailConfirm">Riceverai una email di conferma a breve</p>
            </div>
        </div>
        
        <!-- Sezione Login Admin -->
        <div id="login" class="section hidden" style="max-width: 500px; margin: 50px auto;">
            <h2><i class="fas fa-lock"></i> <span id="loginTitle">Accesso Admin</span></h2>
            
            <div class="form-group">
                <label for="pwd" id="passwordLabel">Password</label>
                <input type="password" id="pwd" placeholder="Inserisci la password">
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button onclick="login()" class="btn">
                    <i class="fas fa-sign-in-alt"></i> <span id="loginBtn">Accedi</span>
                </button>
                <button onclick="closeLogin()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> <span id="cancelBtn">Annulla</span>
                </button>
            </div>
            
            <p style="margin-top: 20px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.6);">
                <i class="fas fa-info-circle"></i> La password √® stata impostata dal festeggiato
            </p>
        </div>
        
        <!-- Sezione Dashboard Admin -->
        <div id="dashboard" class="section hidden">
            <h2><i class="fas fa-chart-bar"></i> <span id="dashboardTitle">Dashboard Admin</span></h2>
            
            <button onclick="logout()" class="btn btn-secondary" style="margin-bottom: 30px;">
                <i class="fas fa-sign-out-alt"></i> <span id="logoutBtn">Esci</span>
            </button>
            
            <div class="stats">
                <div class="stat-box">
                    <span class="stat-number" id="totalCount">0</span>
                    <span id="totalLabel">Totale Risposte</span>
                </div>
                <div class="stat-box">
                    <span class="stat-number" id="yesCount">0</span>
                    <span id="yesLabel">Partecipano</span>
                </div>
                <div class="stat-box">
                    <span class="stat-number" id="noCount">0</span>
                    <span id="noLabel">Non Partecipano</span>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div>
                    <h3><i class="fas fa-list"></i> <span id="listTitle">Elenco Partecipanti</span></h3>
                    <div id="lista" class="loading">
                        Caricamento...
                    </div>
                </div>
                
                <div>
                    <h3><i class="fas fa-chart-pie"></i> <span id="chartTitle">Statistiche</span></h3>
                    <canvas id="chart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <p>Creato con ‚ù§Ô∏è per il 18¬∞ compleanno di Flavio Carlo</p>
            <p style="margin-top: 10px;">
                <i class="fas fa-code"></i> Powered by Firebase & Formspree
            </p>
        </footer>
    </div>

    <!-- Firebase e Chart.js -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ========== CONFIGURAZIONE FIREBASE (LA TUA) ==========
        const firebaseConfig = {
            apiKey: "AIzaSyD52wn88EGkEHRssIfpRbW35Og8-Y6dqY8",
            authDomain: "diciottesimo-24e19.firebaseapp.com",
            projectId: "diciottesimo-24e19",
            storageBucket: "diciottesimo-24e19.firebasestorage.app",
            messagingSenderId: "115904181457",
            appId: "1:115904181457:web:7de1e3755dc6407f7f01f0",
            measurementId: "G-4D679DRVH1"
        };

        // Inizializza Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ========== VARIABILI GLOBALI ==========
        let lang = 'it';
        let chart = null;

        // Traduzioni complete
        const translations = {
            it: {
                // Header
                mainTitle: "Il 18¬∞ Compleanno di Flavio Carlo!",
                subtitle: "Un giorno speciale da festeggiare insieme",
                dateTitle: "Data",
                dateValue: "Mercoled√¨, 1 Aprile 2026",
                locationTitle: "Luogo",
                locationValue: "Casina dei nonni",
                timeTitle: "Ora",
                timeValue: "20:30",
                mapBtn: "Vedi sulla Mappa",
                
                // Mappa
                mapTitle: "Come Raggiungerci",
                mapText: "Festa alla 'Casina dei nonni'",
                
                // Lingua
                langTitle: "Seleziona Lingua",
                langSubtitle: "Scegli la lingua per compilare il modulo di partecipazione",
                
                // Form
                formTitle: "Conferma la tua partecipazione",
                nomeLabel: "Nome e Cognome *",
                emailLabel: "Email *",
                emailNote: "Riceverai una conferma e i dettagli per aggiungere l'evento al calendario",
                partecipazioneLabel: "Parteciperai? *",
                allergieLabel: "Allergie o Intolleranze Alimentari",
                messaggioLabel: "Messaggio per Flavio (opzionale)",
                yesOption: "S√¨, ci sar√≤! üéâ",
                noOption: "No, purtroppo non posso üò¢",
                submitText: "Invia Risposta",
                backText: "Torna indietro",
                
                // Successo
                successTitle: "Grazie!",
                successText: "La tua risposta √® stata inviata con successo.",
                emailConfirm: "Riceverai una email di conferma a breve",
                
                // Admin
                loginTitle: "Accesso Admin",
                passwordLabel: "Password",
                loginBtn: "Accedi",
                cancelBtn: "Annulla",
                dashboardTitle: "Dashboard Admin",
                logoutBtn: "Esci",
                totalLabel: "Totale Risposte",
                yesLabel: "Partecipano",
                noLabel: "Non Partecipano",
                listTitle: "Elenco Partecipanti",
                chartTitle: "Statistiche",
                
                // Messaggi
                loading: "Caricamento...",
                noResponses: "Ancora nessuna risposta",
                error: "Errore nel caricamento dei dati",
                wrongPassword: "Password errata!",
                sending: "Invio in corso...",
                requiredFields: "Compila tutti i campi obbligatori!",
                sendingError: "Errore nell'invio. Riprova pi√π tardi."
            },
            en: {
                // Header
                mainTitle: "Flavio Carlo's 18th Birthday Party!",
                subtitle: "A special day to celebrate together",
                dateTitle: "Date",
                dateValue: "Wednesday, April 1, 2026",
                locationTitle: "Location",
                locationValue: "Grandparents' cottage",
                timeTitle: "Time",
                timeValue: "8:30 PM",
                mapBtn: "View on Map",
                
                // Map
                mapTitle: "How to Get There",
                mapText: "Party at the 'Grandparents' cottage'",
                
                // Language
                langTitle: "Select Language",
                langSubtitle: "Choose the language to fill out the participation form",
                
                // Form
                formTitle: "Confirm Your Attendance",
                nomeLabel: "Full Name *",
                emailLabel: "Email *",
                emailNote: "You will receive a confirmation and details to add the event to your calendar",
                partecipazioneLabel: "Will you attend? *",
                allergieLabel: "Food Allergies or Intolerances",
                messaggioLabel: "Message for Flavio (optional)",
                yesOption: "Yes, I'll be there! üéâ",
                noOption: "No, unfortunately I can't üò¢",
                submitText: "Send Response",
                backText: "Go Back",
                
                // Success
                successTitle: "Thank You!",
                successText: "Your response has been sent successfully.",
                emailConfirm: "You will receive a confirmation email shortly",
                
                // Admin
                loginTitle: "Admin Login",
                passwordLabel: "Password",
                loginBtn: "Login",
                cancelBtn: "Cancel",
                dashboardTitle: "Admin Dashboard",
                logoutBtn: "Logout",
                totalLabel: "Total Responses",
                yesLabel: "Attending",
                noLabel: "Not Attending",
                listTitle: "Guest List",
                chartTitle: "Statistics",
                
                // Messages
                loading: "Loading...",
                noResponses: "No responses yet",
                error: "Error loading data",
                wrongPassword: "Wrong password!",
                sending: "Sending...",
                requiredFields: "Please fill in all required fields!",
                sendingError: "Error sending. Please try again later."
            }
        };

        // ========== FUNZIONI ==========
        
        // Imposta la lingua
        function setLang(l) {
            lang = l;
            
            // Aggiorna pulsanti lingua
            document.getElementById('langBtnIt').classList.toggle('active', l === 'it');
            document.getElementById('langBtnEn').classList.toggle('active', l === 'en');
            
            // Mostra form, nascondi selezione lingua
            document.getElementById('lang').classList.add('hidden');
            document.getElementById('form').classList.remove('hidden');
            
            // Nascondi messaggio di successo se presente
            document.getElementById('successMessage').classList.add('hidden');
            
            // Imposta la lingua nascosta per Formspree
            document.getElementById('formLanguage').value = l;
            
            // Aggiorna tutti i testi
            updateTexts();
            
            // Opzioni del select
            const select = document.getElementById('partecipazione');
            const t = translations[lang];
            select.innerHTML = `
                <option value=""></option>
                <option value="si">${t.yesOption}</option>
                <option value="no">${t.noOption}</option>
            `;
        }
        
        // Aggiorna tutti i testi in base alla lingua
        function updateTexts() {
            const t = translations[lang];
            
            // Header
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('dateTitle').textContent = t.dateTitle;
            document.getElementById('dateValue').textContent = t.dateValue;
            document.getElementById('locationTitle').textContent = t.locationTitle;
            document.getElementById('locationValue').textContent = t.locationValue;
            document.getElementById('timeTitle').textContent = t.timeTitle;
            document.getElementById('timeValue').textContent = t.timeValue;
            document.getElementById('mapBtn').textContent = t.mapBtn;
            
            // Mappa
            document.getElementById('mapTitle').textContent = t.mapTitle;
            document.getElementById('mapText').textContent = t.mapText;
            
            // Lingua
            document.getElementById('langTitle').textContent = t.langTitle;
            document.getElementById('langSubtitle').textContent = t.langSubtitle;
            
            // Form
            document.getElementById('formTitle').textContent = t.formTitle;
            document.getElementById('nomeLabel').textContent = t.nomeLabel;
            document.getElementById('emailLabel').textContent = t.emailLabel;
            document.getElementById('emailNote').textContent = t.emailNote;
            document.getElementById('partecipazioneLabel').textContent = t.partecipazioneLabel;
            document.getElementById('allergieLabel').textContent = t.allergieLabel;
            document.getElementById('messaggioLabel').textContent = t.messaggioLabel;
            document.getElementById('submitText').textContent = t.submitText;
            document.getElementById('backText').textContent = t.backText;
            
            // Successo
            document.getElementById('successTitle').textContent = t.successTitle;
            document.getElementById('successText').textContent = t.successText;
            document.getElementById('emailConfirm').textContent = t.emailConfirm;
            
            // Admin
            document.getElementById('loginTitle').textContent = t.loginTitle;
            document.getElementById('passwordLabel').textContent = t.passwordLabel;
            document.getElementById('loginBtn').textContent = t.loginBtn;
            document.getElementById('cancelBtn').textContent = t.cancelBtn;
            document.getElementById('dashboardTitle').textContent = t.dashboardTitle;
            document.getElementById('logoutBtn').textContent = t.logoutBtn;
            document.getElementById('totalLabel').textContent = t.totalLabel;
            document.getElementById('yesLabel').textContent = t.yesLabel;
            document.getElementById('noLabel').textContent = t.noLabel;
            document.getElementById('listTitle').textContent = t.listTitle;
            document.getElementById('chartTitle').textContent = t.chartTitle;
        }
        
        // Torna alla selezione lingua
        function changeLang() {
            document.getElementById('form').classList.add('hidden');
            document.getElementById('lang').classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('rsvpForm').reset();
        }
        
        // Invia dati a Formspree E Firebase
        function sendData(e) {
            e.preventDefault();
            
            const nome = document.getElementById('nome').value.trim();
            const email = document.getElementById('email').value.trim();
            const partecipa = document.getElementById('partecipazione').value;
            const allergie = document.getElementById('allergie').value.trim() || 'Nessuna';
            const messaggio = document.getElementById('messaggio').value.trim() || '';
            
            if (!nome || !email || !partecipa) {
                alert(translations[lang].requiredFields);
                return;
            }
            
            // Validazione email semplice
            if (!email.includes('@') || !email.includes('.')) {
                alert("Inserisci un indirizzo email valido");
                return;
            }
            
            // Imposta l'email per la risposta automatica di Formspree
            document.getElementById('replyToField').value = email;
            
            // Mostra messaggio di caricamento
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${translations[lang].sending}`;
            submitBtn.disabled = true;
            
            // 1. PRIMA: Prepara i dati per Firebase
            const firebaseData = {
                nome: nome,
                email: email,
                partecipa: partecipa,
                allergie: allergie,
                messaggio: messaggio,
                lingua: lang,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                dataInvio: new Date().toLocaleString(),
                emailInviata: false
            };
            
            // 2. SECONDO: Salva su Firebase
            db.collection('risposte').add(firebaseData)
                .then(() => {
                    console.log('‚úÖ Dati salvati su Firebase');
                    
                    // 3. TERZO: Invia il form a Formspree (che invier√† le email)
                    // Questo avvia l'invio tramite l'azione del form che abbiamo impostato
                    document.getElementById('rsvpForm').submit();
                    
                    // Mostra messaggio di successo (anche se il submit reindirizza)
                    document.getElementById('successMessage').classList.remove('hidden');
                    document.getElementById('rsvpForm').reset();
                    
                    // Scrolla al messaggio di successo
                    document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
                    
                    // Ripristina il pulsante dopo 3 secondi
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 3000);
                })
                .catch(err => {
                    // Errore Firebase
                    console.error('‚ùå Errore Firestore:', err);
                    alert(translations[lang].sendingError);
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
        }
        
        // Mostra login admin
        document.getElementById('adminBtn').addEventListener('click', () => {
            document.getElementById('login').classList.remove('hidden');
            document.getElementById('pwd').value = '';
            document.getElementById('pwd').focus();
        });
        
        // Chiudi login admin
        function closeLogin() {
            document.getElementById('login').classList.add('hidden');
        }
        
        // Login admin
        function login() {
            const password = document.getElementById('pwd').value;
            
            // MODIFICA QUESTA PASSWORD CON UNA SICURA!
            if (password === 'admin18') {
                closeLogin();
                document.getElementById('adminBtn').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                
                loadDashboard();
                createConfetti(50);
            } else {
                alert(translations[lang].wrongPassword);
                document.getElementById('pwd').value = '';
                document.getElementById('pwd').focus();
            }
        }
        
        // Carica dati dashboard
        function loadDashboard() {
            const lista = document.getElementById('lista');
            lista.innerHTML = `<div class="loading">${translations[lang].loading}</div>`;
            
            db.collection('risposte')
                .orderBy('timestamp', 'desc')
                .get()
                .then(snapshot => {
                    let si = 0, no = 0;
                    let html = '';
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        
                        if (data.partecipa === 'si') {
                            si++;
                        } else {
                            no++;
                        }
                        
                        const nome = data.nome || 'N/A';
                        const email = data.email || 'N/A';
                        const partecipa = data.partecipa === 'si' 
                            ? `<span style="color: #4ecdc4;">‚úÖ ${translations[lang].yesLabel}</span>` 
                            : `<span style="color: #ff6b6b;">‚ùå ${translations[lang].noLabel}</span>`;
                        const allergie = data.allergie || '-';
                        const messaggio = data.messaggio ? `<br><em>"${data.messaggio}"</em>` : '';
                        const date = data.dataInvio || new Date().toLocaleDateString();
                        const emailInviata = data.emailInviata ? '<span style="color:#4ecdc4">‚úì Email inv.</span>' : '<span style="color:#ff6b6b">‚úó Email non inv.</span>';
                        
                        html += `
                            <div class="guest-item">
                                <strong>${nome}</strong><br>
                                Email: ${email} ${emailInviata}<br>
                                ${partecipa} | ${translations[lang].allergieLabel}: ${allergie}${messaggio}<br>
                                <small>${date}</small>
                            </div>
                        `;
                    });
                    
                    // Aggiorna contatori
                    document.getElementById('totalCount').textContent = si + no;
                    document.getElementById('yesCount').textContent = si;
                    document.getElementById('noCount').textContent = no;
                    
                    // Aggiorna lista
                    if (snapshot.empty) {
                        lista.innerHTML = `<p>${translations[lang].noResponses}</p>`;
                    } else {
                        lista.innerHTML = html;
                    }
                    
                    // Crea/aggiorna grafico
                    updateChart(si, no);
                })
                .catch(err => {
                    console.error('Errore caricamento dati:', err);
                    lista.innerHTML = `<p>${translations[lang].error}</p>`;
                });
        }
        
        // Crea/aggiorna grafico
        function updateChart(si, no) {
            const ctx = document.getElementById('chart').getContext('2d');
            
            // Distruggi grafico esistente
            if (chart) {
                chart.destroy();
            }
            
            const t = translations[lang];
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        `${t.yesLabel} (${si})`,
                        `${t.noLabel} (${no})`
                    ],
                    datasets: [{
                        data: [si, no],
                        backgroundColor: ['#4ecdc4', '#ff6b6b'],
                        borderWidth: 3,
                        borderColor: '#2d3047',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(45, 48, 71, 0.9)',
                            titleColor: 'white',
                            bodyColor: 'white'
                        }
                    }
                }
            });
        }
        
        // Logout admin
        function logout() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('adminBtn').classList.remove('hidden');
            if (chart) {
                chart.destroy();
                chart = null;
            }
        }
        
        // Crea confetti
        function createConfetti(count) {
            const container = document.getElementById('confetti-container');
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Posizione casuale
                confetti.style.left = Math.random() * 100 + 'vw';
                
                // Colore casuale
                const colors = ['#7b6cff', '#ff6b6b', '#4ecdc4', '#ffd166', '#06d6a0'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Dimensione casuale
                const size = Math.random() * 15 + 5;
                confetti.style.width = size + 'px';
                confetti.style.height = size + 'px';
                
                // Animazione casuale
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                
                container.appendChild(confetti);
                
                // Rimuovi dopo l'animazione
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            // Sovrascrivi l'invio predefinito del form
            document.getElementById('rsvpForm').addEventListener('submit', sendData);
            
            // Testa connessione Firebase
            db.collection('risposte').get()
                .then(() => {
                    console.log('‚úÖ Firebase connesso correttamente');
                    createConfetti(30); // Confetti iniziali
                })
                .catch(err => {
                    console.error('‚ùå Errore Firebase:', err);
                });
            
            // Mostra il pulsante admin dopo il caricamento
            setTimeout(() => {
                document.getElementById('adminBtn').classList.remove('hidden');
            }, 1000);
            
            // Aggiorna testi iniziali
            updateTexts();
            
            // Aggiungi opzioni al select
            const select = document.getElementById('partecipazione');
            select.innerHTML = `
                <option value=""></option>
                <option value="si">${translations[lang].yesOption}</option>
                <option value="no">${translations[lang].noOption}</option>
            `;
        });
    </script>
</body>
</html>
