<!-- aggiungi type="button" ai button che NON devono fare submit -->
<button type="button" id="adminBtn">admin</button>

<!-- nella parte JS -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // ðŸ”¹ DOM elements
  const langDiv = document.getElementById('lang');
  const formDiv = document.getElementById('form');
  const loginDiv = document.getElementById('login');
  const dashboardDiv = document.getElementById('dashboard');
  const title = document.getElementById('title');
  const partecipazione = document.getElementById('partecipazione');
  const nome = document.getElementById('nome');
  const allergie = document.getElementById('allergie');
  const pwd = document.getElementById('pwd');
  const lista = document.getElementById('lista');
  const chartCanvas = document.getElementById('chart');
  const adminBtn = document.getElementById('adminBtn');

  let lang = 'it';
  const t = {
    it: { title: 'Conferma partecipazione', yes: 'Partecipo', no: 'Non partecipo' },
    en: { title: 'RSVP Confirmation', yes: 'I will attend', no: 'I will not attend' }
  };

  // Event listeners
  adminBtn.addEventListener('click', () => {
    loginDiv.classList.remove('hidden');
  });

  window.setLang = (l) => {
    lang = l;
    langDiv.classList.add('hidden');
    formDiv.classList.remove('hidden');
    title.innerText = t[l].title;
    partecipazione.innerHTML = `<option></option>
      <option value="si">${t[l].yes}</option>
      <option value="no">${t[l].no}</option>`;
  };

  window.sendData = (e) => {
    e.preventDefault();
    const data = {
      nome: nome.value,
      partecipa: partecipazione.value,
      allergie: allergie.value,
      ts: Date.now()
    };
    db.collection('risposte').add(data)
      .then(() => {
        // EmailJS deve avere chiavi reali
        alert('Risposta inviata');
        e.target.reset();
      })
      .catch(err => alert('Errore invio dati: '+err));
  };

  window.login = () => {
    if(pwd.value === 'admin18'){
      loginDiv.classList.add('hidden');
      dashboardDiv.classList.remove('hidden');

      db.collection('risposte').get().then(snap => {
        let si = 0, no = 0;
        lista.innerHTML = '';
        snap.forEach(d => {
          const data = d.data();
          data.partecipa === 'si' ? si++ : no++;
          lista.innerHTML += `<p>${data.nome} â€“ ${data.partecipa}</p>`;
        });

        new Chart(chartCanvas,{
          type:'bar',
          data:{
            labels:['Si','No'],
            datasets:[{data:[si,no], backgroundColor:['#7b6cff','#ff6b6b'] }]
          },
          options:{responsive:true, plugins:{legend:{display:false}}}
        });
      });

    } else {
      alert('Password errata');
    }
  };
});
</script>
